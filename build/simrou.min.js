/*
 Simrou v1.5.4 - Released under the MIT License.
 Copyright (c) 2012 büro für ideen, www.buero-fuer-ideen.de
*/
(function(){var j,l,m={}.hasOwnProperty,n=[].slice,d=function(a){var b=this;this.handleFormSubmit=function(a){return d.prototype.handleFormSubmit.apply(b,arguments)};this.resolveHash=function(a){return d.prototype.resolveHash.apply(b,arguments)};this.routes={};this.observeForms=this.observeHash=this.listening=!1;this.history=[];this.travelLounge={};null!=a&&this.addRoutes(a);null!=this.initialize&&this.initialize()};d.prototype.RegExpCache={extractHash:/^[^#]*(#.*)$/,trimHash:/^#*(.*?)\/*$/};l=d.prototype;
var f;f=window.document.documentMode;l.eventSupported="onhashchange"in window&&(null==f||7<f);d.prototype.addRoute=function(a,b){var c;null==b&&(b=!0);c=a instanceof j?a:new j(a,b);return this.routes[c.toString()]=c};d.prototype.addRoutes=function(a,b){var c,e,g,h;null==b&&(b=!0);if(jQuery.isFunction(a))e=a.call(this,b);else if(jQuery.isArray(a)){e=[];c=0;for(g=a.length;c<g;c++)h=a[c],e.push(this.addRoutes(h,b))}else if(jQuery.isPlainObject(a))for(g in e={},a)m.call(a,g)&&(c=a[g],h=this.addRoute(g,
b),h.attachActions(c),e[g]=h);else e=this.addRoute(a,b);return e};d.prototype.removeRoute=function(a){a instanceof j||(a=new j(a));a=a.toString();if(a in this.routes)return delete this.routes[a]};d.prototype.navigate=function(a){var b;b=this.getHash();location.hash=a;if(!this.observeHash||location.hash===b)return this.resolve(a,"get")};d.prototype.addTraveller=function(a){var b,c,e;e=[];for(b in a)c=b.replace(/\ +?/g,""),e.push(this.travelLounge[c]=a[b]);return e};d.prototype.travelBegins=function(){var a,
b;a=this.history;a=a.toString();b=this.travelLounge;if(a in b)return b[a]()};d.prototype.resolve=function(a,b){var c,e,g,h,d;e=String(a).replace(this.RegExpCache.trimHash,"$1");if(""===e){if(-1===String(a).indexOf("/"))return!1;e="/"}d=this.routes;for(g in d)if(m.call(d,g)&&(c=d[g],c instanceof j&&(h=c.match(e))))return e=[h,b],c=jQuery(c),c.trigger("simrou:any",e),null!=b&&"any"!==b&&c.trigger("simrou:"+b.toLowerCase(),e),!0;return!1};d.prototype.saveHistory=function(a){this.history.push(a.replace(/#/,
"").toString());if(2<this.history.length)return this.history.shift()};d.prototype.getHash=function(a){null==a&&(a=location.hash);return String(a).replace(this.RegExpCache.extractHash,"$1")};d.prototype.resolveHash=function(a){var b;if(this.observeHash)return this.eventSupported&&(b=a.originalEvent.newURL),a=this.getHash(b),this.saveHistory(a),this.resolve(a,"get"),this.travelBegins()};d.prototype.handleFormSubmit=function(a){var b,c;this.observeForms&&(b=jQuery(a.target),c=b.attr("method")||b.get(0).getAttribute("method"),
b=this.getHash(b.attr("action")),this.resolve(b,c)&&a.preventDefault());return!0};d.prototype.listen=function(){var a=this;if(!this.listening)return jQuery(window).on("hashchange.simrou",this.resolveHash),jQuery(function(){return jQuery("body").on("submit.simrou","form",a.handleFormSubmit)}),this.listening=!0};d.prototype.start=function(a,b,c){this.observeHash=null!=b?b:!0;this.observeForms=null!=c?c:!0;(this.observeHash||this.observeForms)&&this.listen();b=this.getHash();if(""!==b)return this.saveHistory(b),
this.resolve(b,"get");if(null!=a)return this.saveHistory(a),null!=window.history&&null!=window.history.replaceState?(window.history.replaceState({},document.title,"#"+a.replace(/^#+/,"")),this.resolve(a,"get")):this.navigate(a)};d.prototype.stop=function(){return this.observeForms=this.observeHash=!1};l=d;f=function(a,b){var c,e;this.pattern=a;this.caseSensitive=null!=b?b:!0;a=String(this.pattern);e=a.match(this.RegExpCache.allParams);if(null!=e){var g,d,f;f=[];g=0;for(d=e.length;g<d;g++)c=e[g],f.push(c.substr(1));
c=f}else c=[];this.params=c;a=a.replace(this.RegExpCache.escapeRegExp,"\\$&");a=a.replace(this.RegExpCache.namedParam,"([^/]+)");a=a.replace(this.RegExpCache.splatParam,"(.+?)");this.expr=RegExp("^"+a+"$",b?"":"i")};var k;f.prototype.RegExpCache={escapeRegExp:/[-[\]{}()+?.,\\^$|#\s]/g,namedParam:/:(\w+)/g,splatParam:/\*(\w+)/g,firstParam:/(:\w+)|(\*\w+)/,allParams:/(:|\*)\w+/g};f.prototype.match=function(a){var b,c,e,g,d,f;b=this.expr.exec(a);if(jQuery.isArray(b)){e={};f=this.params;a=g=0;for(d=f.length;g<
d;a=++g)c=f[a],e[c]=b[a+1]}else e=!1;return e};f.prototype.assemble=function(){var a,b,c;c=1<=arguments.length?n.call(arguments,0):[];if(0<c.length)if(jQuery.isArray(c[0]))c=c[0];else if(jQuery.isPlainObject(c[0])){var e,d,f;d=this.params;f=[];b=0;for(e=d.length;b<e;b++)a=d[b],f.push(a in c[0]?c[0][a]:"");c=f}for(a=String(this.pattern);this.RegExpCache.firstParam.test(a);)b=0<c.length?c.shift():"",jQuery.isFunction(b)&&(b=b(this)),a=a.replace(this.RegExpCache.firstParam,String(b));return a};f.prototype.toString=
function(){return String(this.pattern)};f.prototype.attachAction=function(a,b){null==b&&(b="any");jQuery(this).on("simrou:"+b.toLowerCase(),a);return this};f.prototype.attachActions=function(a,b){var c,e,d,f;null==b&&(b="any");jQuery.isPlainObject(a)||(c=[{},a],a=c[0],c=c[1],a[b]=c);for(b in a)if(m.call(a,b)){e=a[b];jQuery.isArray(e)||(e=[e]);d=0;for(f=e.length;d<f;d++)c=e[d],this.attachAction(c,b)}return this};f.prototype.detachAction=function(a,b){var c;null==b&&(b="any");"string"===typeof a&&(b=
a);c="simrou:"+b.toLowerCase();jQuery.isFunction(a)?jQuery(this).off(c,a):jQuery(this).off(c);return this};k=function(a){return function(b){return this.attachAction(b,a)}};f.prototype.get=k("get");f.prototype.post=k("post");f.prototype.put=k("put");f.prototype["delete"]=k("delete");f.prototype.any=k("any");j=f;l.Route=j;window.Simrou=jQuery.Simrou=l}).call(this);
